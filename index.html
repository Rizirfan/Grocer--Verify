<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Grocer Verify AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            padding-top: max(10px, env(safe-area-inset-top));
            padding-bottom: max(10px, env(safe-area-inset-bottom));
        }

        .container {
            width: 100%;
            max-width: 420px;
            height: auto;
            max-height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-icon {
            font-size: 1.8em;
        }

        .header-text h1 {
            font-size: 1em;
            font-weight: 700;
            margin: 0;
            line-height: 1.2;
        }

        .header-text p {
            font-size: 0.7em;
            opacity: 0.9;
            margin: 2px 0 0 0;
            line-height: 1.2;
        }

        .language-selector {
            display: flex;
            gap: 6px;
        }

        .lang-btn {
            padding: 6px 12px;
            border: 2px solid white;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8em;
            transition: all 0.3s;
            min-width: 60px;
        }

        .lang-btn.inactive {
            background: transparent;
            color: white;
        }

        .lang-btn:active {
            transform: scale(0.95);
        }

        .tabs {
            display: flex;
            gap: 0;
            padding: 0 12px;
            margin-top: 14px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 10px;
            border: none;
            background: transparent;
            color: #999;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.9em;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-btn span:first-child {
            font-size: 1.2em;
        }

        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .content {
            padding: 16px 14px;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            margin-bottom: 16px;
        }

        input[type="text"], textarea {
            padding: 11px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.3s;
            font-family: inherit;
            width: 100%;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            margin-bottom: 10px;
        }

        .file-input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .file-upload {
            display: none;
        }

        .file-upload-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            cursor: pointer;
            font-weight: 600;
            color: #667eea;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .file-upload-btn:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .file-name {
            margin-top: 8px;
            font-size: 0.85em;
            color: #999;
        }

        .add-btn, .verify-btn {
            padding: 11px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-width: 70px;
        }

        .add-btn:active, .verify-btn:active {
            transform: translateY(1px);
            opacity: 0.9;
        }

        .add-btn:disabled, .verify-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 14px 10px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-total { color: #667eea; }
        .stat-purchased { color: #27ae60; }
        .stat-remaining { color: #f39c12; }

        .stat-label {
            font-size: 0.65em;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            line-height: 1.2;
        }

        .shopping-list {
            list-style: none;
            margin-bottom: 12px;
        }

        .shopping-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #e9ecef;
            transition: all 0.2s;
        }

        .shopping-item:active {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .shopping-item.bought {
            background: #f5f5f5;
            opacity: 0.7;
        }

        .shopping-item.bought .item-text {
            text-decoration: line-through;
            color: #999;
        }

        .shopping-item.matched {
            background: #f0fdf4;
            border-color: #27ae60;
        }

        .checkbox-circle {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #e9ecef;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            border: 2px solid #e9ecef;
        }

        .checkbox-circle:active {
            transform: scale(0.95);
        }

        .item-text {
            flex: 1;
            font-size: 0.95em;
            color: #333;
            font-weight: 500;
            word-break: break-word;
        }

        .item-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            background: #e8f5e9;
            color: #27ae60;
            font-weight: 600;
        }

        .delete-btn {
            background: transparent;
            border: none;
            color: #ddd;
            cursor: pointer;
            font-size: 1.1em;
            transition: color 0.2s;
            padding: 4px;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .delete-btn:active {
            transform: scale(0.9);
            color: #e74c3c;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e9ecef;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .action-btn.clear-purchased {
            background: transparent;
            color: #27ae60;
            border: 2px solid #27ae60;
        }

        .action-btn.clear-purchased:active {
            background: #f0fdf4;
        }

        .action-btn.clear-all {
            background: transparent;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }

        .action-btn.clear-all:active {
            background: #fef2f2;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .verify-content {
            padding: 20px;
        }

        .comparison-result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item-name {
            flex: 1;
            font-weight: 500;
        }

        .result-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .badge-found {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-missing {
            background: #fee2e2;
            color: #991b1b;
        }

        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
            text-align: center;
        }

        .summary-title {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 1.8em;
            font-weight: 700;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .processing {
            text-align: center;
            padding: 20px;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.9em;
        }

        .divider {
            text-align: center;
            margin: 12px 0;
            color: #999;
        }

        .info-box {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 0.85em;
            color: #92400e;
            line-height: 1.4;
        }

        .ocr-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 700;
            margin-left: 8px;
        }

        footer {
            background: #f8f9fa;
            padding: 12px 14px;
            text-align: center;
            color: #999;
            font-size: 0.75em;
            border-top: 1px solid #e9ecef;
            flex-shrink: 0;
            line-height: 1.4;
        }

        .footer-main {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .footer-developer {
            display: block;
            font-size: 0.7em;
            opacity: 0.8;
        }

        .content-wrapper::-webkit-scrollbar {
            width: 4px;
        }

        .content-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .content-wrapper::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 2px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 12px;
        }

        .modal-header h2 {
            font-size: 1.2em;
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #667eea;
        }

        /* Full screen mode */
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0;
        }

        .fullscreen .container {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            border-radius: 0;
            box-shadow: none;
        }

        .fullscreen .content-wrapper {
            max-height: calc(100vh - 120px);
        }

        /* Responsive breakpoints for different mobile sizes */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                margin: 0;
            }

            header {
                padding: 12px 10px;
            }

            .header-text h1 {
                font-size: 0.9em;
            }

            .header-text p {
                font-size: 0.6em;
            }

            .language-selector {
                gap: 4px;
            }

            .lang-btn {
                padding: 4px 8px;
                font-size: 0.7em;
                min-width: 50px;
            }

            .tabs {
                padding: 0 8px;
                margin-top: 10px;
            }

            .tab-btn {
                padding: 10px 6px;
                font-size: 0.85em;
            }

            .content {
                padding: 12px 8px;
            }

            .input-section {
                gap: 6px;
            }

            .add-btn {
                padding: 9px 12px;
                font-size: 0.9em;
                min-width: 60px;
            }

            .stats-container {
                gap: 6px;
                margin-bottom: 12px;
            }

            .stat-box {
                padding: 12px 6px;
            }

            .stat-number {
                font-size: 1.6em;
            }

            .stat-label {
                font-size: 0.6em;
            }

            .shopping-item {
                padding: 10px;
                margin-bottom: 6px;
            }

            .checkbox-circle {
                width: 20px;
                height: 20px;
                font-size: 0.8em;
            }

            .item-text {
                font-size: 0.9em;
            }

            .delete-btn {
                width: 24px;
                height: 24px;
                font-size: 1em;
            }

            .action-buttons {
                gap: 8px;
                margin-top: 10px;
                padding-top: 10px;
            }

            .action-btn {
                padding: 8px;
                font-size: 0.8em;
            }

            footer {
                padding: 10px 8px;
                font-size: 0.65em;
            }

            .modal {
                max-width: 95%;
                margin: 5px;
                padding: 16px;
            }

            .modal-header h2 {
                font-size: 1.1em;
            }
        }

        @media (max-width: 360px) {
            .container {
                border-radius: 15px;
            }

            header {
                padding: 10px 8px;
            }

            .header-left {
                gap: 8px;
            }

            .header-icon {
                font-size: 1.5em;
            }

            .header-text h1 {
                font-size: 0.85em;
            }

            .header-text p {
                font-size: 0.55em;
            }

            .lang-btn {
                padding: 3px 6px;
                font-size: 0.65em;
                min-width: 45px;
            }

            .tabs {
                padding: 0 6px;
                margin-top: 8px;
            }

            .tab-btn {
                padding: 8px 4px;
                font-size: 0.8em;
            }

            .content {
                padding: 10px 6px;
            }

            .input-section {
                gap: 4px;
            }

            input[type="text"] {
                padding: 8px 10px;
                font-size: 0.9em;
            }

            .add-btn {
                padding: 8px 10px;
                font-size: 0.85em;
                min-width: 55px;
            }

            .stats-container {
                gap: 4px;
                margin-bottom: 10px;
            }

            .stat-box {
                padding: 10px 4px;
            }

            .stat-number {
                font-size: 1.4em;
            }

            .stat-label {
                font-size: 0.55em;
            }

            .shopping-item {
                padding: 8px;
                margin-bottom: 4px;
            }

            .checkbox-circle {
                width: 18px;
                height: 18px;
                font-size: 0.7em;
            }

            .item-text {
                font-size: 0.85em;
            }

            .delete-btn {
                width: 22px;
                height: 22px;
                font-size: 0.9em;
            }

            .action-buttons {
                gap: 6px;
                margin-top: 8px;
                padding-top: 8px;
            }

            .action-btn {
                padding: 6px;
                font-size: 0.75em;
            }

            footer {
                padding: 8px 6px;
                font-size: 0.6em;
            }

            .modal {
                max-width: 98%;
                margin: 2px;
                padding: 12px;
            }

            .modal-header h2 {
                font-size: 1em;
            }

            .modal-header {
                margin-bottom: 12px;
                padding-bottom: 8px;
            }
        }

        @media (max-height: 600px) {
            header {
                padding: 12px 12px;
            }

            .header-text h1 {
                font-size: 1.2em;
            }

            .header-text p {
                font-size: 0.65em;
            }

            .tabs {
                margin-top: 8px;
                padding: 0 10px;
            }

            .content {
                padding: 12px 10px;
            }

            .stats-container {
                margin-bottom: 12px;
                gap: 8px;
            }

            .stat-box {
                padding: 10px 8px;
            }

            .stat-number {
                font-size: 1.5em;
            }

            .modal {
                max-height: 90vh;
                margin: 10px;
            }
        }

        /* Landscape orientation adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                max-height: 95vh;
            }

            .content-wrapper {
                max-height: calc(95vh - 100px);
            }

            header {
                padding: 8px 10px;
            }

            .header-text h1 {
                font-size: 0.9em;
            }

            .header-text p {
                font-size: 0.6em;
            }

            .tabs {
                margin-top: 6px;
            }

            .content {
                padding: 8px 10px;
            }

            .stats-container {
                margin-bottom: 8px;
            }

            .shopping-item {
                padding: 8px;
            }

            .action-buttons {
                margin-top: 6px;
                padding-top: 6px;
            }

            footer {
                padding: 6px 10px;
            }
        }

        /* Large mobile devices */
        @media (min-width: 481px) and (max-width: 768px) {
            .container {
                max-width: 450px;
            }

            .modal {
                max-width: 400px;
            }
        }

        /* Tablet adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 500px;
            }

            .modal {
                max-width: 450px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <div class="header-icon"><i class="fa-solid fa-bag-shopping"></i></div>
                <div class="header-text">
                    <h1 id="appTitle">Grocer Verify AI</h1>
                    <p id="appSubtitle">Smart Shopping</p>
                </div>
            </div>
            <div class="language-selector">
                <button class="lang-btn active" onclick="changeLanguage('en')" id="engBtn">EN</button>
                <button class="lang-btn inactive" onclick="changeLanguage('ta')" id="tamBtn">TM</button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('shopping')" id="shoppingTab">
                <span>üìù</span>
                <span id="shoppingTabLabel">List</span>
            </button>
        </div>

        <div class="content-wrapper">
            <!-- Shopping List Page -->
            <div id="shoppingPage" class="page active">
                <div class="content">
                    <div class="input-section">
                        <input type="text" id="itemInput" placeholder="e.g., Milk 1/2 l">
                        <button class="add-btn" onclick="addItem()" id="addBtn">
                            <span>+</span>
                            <span id="addBtnText">Add</span>
                        </button>
                    </div>

                    <div class="stats-container" id="statsContainer" style="display: none;">
                        <div class="stat-box">
                            <div class="stat-number stat-total" id="totalItems">0</div>
                            <div class="stat-label" id="totalItemsLabel">Total</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number stat-purchased" id="purchasedCount">0</div>
                            <div class="stat-label" id="purchasedLabel">Bought</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number stat-remaining" id="remainingCount">0</div>
                            <div class="stat-label" id="remainingLabel">Left</div>
                        </div>
                    </div>

                    <ul class="shopping-list" id="shoppingList"></ul>

                    <div class="action-buttons" id="actionButtons" style="display: none;">
                        <button class="action-btn clear-purchased" onclick="clearPurchased()" id="clearPurchasedBtn">
                            <span id="clearPurchasedText">Clear</span>
                        </button>
                        <button class="action-btn" onclick="downloadRemaining()" id="downloadRemainingBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                            <i class="fa-solid fa-download"></i>
                            <span id="downloadRemainingText">Download Left</span>
                        </button>
                        <button class="action-btn clear-all" onclick="clearAll()" id="clearAllBtn">
                            <span id="clearAllText">Delete All</span>
                        </button>
                    </div>
                </div>
            </div>


        </div>

        <footer>
            <span class="footer-main" id="footerText">Grocer Verify - Smart Shopping List</span>
            <span class="footer-developer">Developed By Mohamed Irfan</span>
        </footer>
    </div>

    <!-- Download Options Modal -->
    <div class="modal-overlay" id="downloadModal">
        <div class="modal" style="max-width: 350px;">
            <div class="modal-header">
                <h2 style="font-size: 1.2em; margin: 0;">Download Remaining Items</h2>
                <button class="close-btn" onclick="closeDownloadModal()">&times;</button>
            </div>
            <div style="padding: 16px;">
                <p style="margin-bottom: 16px; color: #666; font-size: 0.9em;">Choose your preferred format:</p>
                <div style="display: flex; gap: 12px;">
                    <button class="verify-btn" onclick="downloadAsPDF()" style="flex: 1; padding: 12px;">
                        <i class="fa-solid fa-file-pdf"></i>
                        <span>PDF</span>
                    </button>
                    <button class="verify-btn" onclick="downloadAsImage()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <i class="fa-solid fa-image"></i>
                        <span>Image</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let items = [];
        let currentLanguage = 'en';
        const STORAGE_KEY = 'grocerAI_items';
        const LANG_KEY = 'grocerAI_language';

        const translations = {
            en: {
                appTitle: "Grocer Verify AI",
                appSubtitle: "Smart Shopping",
                shoppingTabLabel: "List",
                verifyTabLabel: "Verify",
                verifyTitle: "Invoice Verification",
                itemPlaceholder: "e.g., Milk 1/2 l",
                addBtnText: "Add",
                totalItemsLabel: "Total",
                purchasedLabel: "Bought",
                remainingLabel: "Left",
                clearPurchasedText: "Clear",
                clearAllText: "Delete All",
                noItems: "No items yet.\nAdd items to get started!",
                enterItem: "Please enter an item",
                confirmClear: "Remove purchased items?",
                confirmClearAll: "Delete all items?",
                invoiceLabel: "Invoice Image:",
                uploadImageText: "üì∏ Take/Upload Receipt Photo",
                verifyBtnText: "Verify & Match",
                newVerifyText: "New Verification",
                verifyingText: "Analyzing invoice with OCR...",
                ocrExtractingText: "Reading text from image...",
                errorNoInvoice: "Please provide invoice data (image or text)",
                errorOCR: "Could not read image. Try uploading a clearer photo.",
                errorVerification: "Verification failed. Please try again.",
                footerText: "Grocer Verify  - Smart Shopping List",
                downloadModalTitle: "Download Remaining Items",
                downloadModalDesc: "Choose your preferred format:",
                pdfBtnText: "PDF",
                imageBtnText: "Image",
                noRemainingItems: "No remaining items to download!"
            },
            ta: {
                appTitle: "Grocer Verify AI",
                appSubtitle: "‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æµ‡Ææ‡Æô‡Øç‡Æï‡ØÅ‡Æ§‡Æ≤‡Øç",
                shoppingTabLabel: "‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Øç",
                verifyTabLabel: "‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                verifyTitle: "‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡ØÅ",
                itemPlaceholder: "‡Æé.‡Æï‡Ææ., ‡Æ™‡Ææ‡Æ≤‡Øç 1/2 ‡Æ≤‡Æø",
                addBtnText: "‡Æö‡Øá‡Æ∞‡Øç",
                totalItemsLabel: "‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç",
                purchasedLabel: "‡Æµ‡Ææ‡Æô‡Øç‡Æï‡Æø‡ÆØ‡Æµ‡Øà",
                remainingLabel: "‡ÆÆ‡ØÄ‡Æ§‡Æø",
                clearPurchasedText: "‡ÆÖ‡Æ¥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                clearAllText: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ ‡ÆÖ‡Æ¥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                noItems: "‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà.\n‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç!",
                enterItem: "‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ≥‡Øà‡Æö‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                confirmClear: "‡Æµ‡Ææ‡Æô‡Øç‡Æï‡Æø‡ÆØ‡Æµ‡Æ±‡Øç‡Æ±‡Øà ‡ÆÖ‡Æ¥‡Æø‡Æï‡Øç‡Æï‡Æµ‡Ææ?",
                confirmClearAll: "‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ¥‡Æø‡Æï‡Øç‡Æï‡Æµ‡Ææ?",
                invoiceLabel: "‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æ™‡Æü‡ÆÆ‡Øç:",
                uploadImageText: "üì∏ ‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ÆÆ‡Øç ‡Æé‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç/‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
                verifyBtnText: "‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç & ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç",
                newVerifyText: "‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡ØÅ",
                verifyingText: "OCR ‡Æâ‡Æü‡Æ©‡Øç ‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
                ocrExtractingText: "‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æâ‡Æ∞‡Øà ‡Æ™‡Æü‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
                errorNoInvoice: "‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æµ‡Æ¥‡Æô‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç (‡Æ™‡Æü‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æâ‡Æ∞‡Øà)",
                errorOCR: "‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà‡Æ™‡Øç ‡Æ™‡Æü‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà. ‡Æ§‡ØÜ‡Æ≥‡Æø‡Æµ‡Ææ‡Æ© ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ± ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
                errorVerification: "‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡Æü‡Øà‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ. ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
                footerText: "Grocer Verify  - Smart Shopping List ",
                downloadModalTitle: "‡ÆÆ‡ØÄ‡Æ§‡ÆÆ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                downloadModalDesc: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ÆÆ‡Ææ‡Æ© ‡Æµ‡Æü‡Æø‡Æµ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:",
                pdfBtnText: "PDF",
                imageBtnText: "‡Æ™‡Æü‡ÆÆ‡Øç",
                noRemainingItems: "‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡ØÅ‡Æµ‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÄ‡Æ§‡ÆÆ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà!"
            }
        };

        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) items = JSON.parse(saved);
                const savedLang = localStorage.getItem(LANG_KEY);
                if (savedLang) currentLanguage = savedLang;
            } catch (e) {
                console.log('Error loading data:', e);
            }
        }

        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
                localStorage.setItem(LANG_KEY, currentLanguage);
            } catch (e) {
                console.log('Error saving data:', e);
            }
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('engBtn').classList.toggle('active', lang === 'en');
            document.getElementById('engBtn').classList.toggle('inactive', lang !== 'en');
            document.getElementById('tamBtn').classList.toggle('active', lang === 'ta');
            document.getElementById('tamBtn').classList.toggle('inactive', lang !== 'ta');
            updatePageText();
            renderItems();
            saveData();
        }

        function updatePageText() {
            const t = translations[currentLanguage];
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('shoppingTabLabel').textContent = t.shoppingTabLabel;
            document.getElementById('itemInput').placeholder = t.itemPlaceholder;
            document.getElementById('addBtnText').textContent = t.addBtnText;
            document.getElementById('totalItemsLabel').textContent = t.totalItemsLabel;
            document.getElementById('purchasedLabel').textContent = t.purchasedLabel;
            document.getElementById('remainingLabel').textContent = t.remainingLabel;
            document.getElementById('clearPurchasedText').textContent = t.clearPurchasedText;
            document.getElementById('clearAllText').textContent = t.clearAllText;
            document.getElementById('downloadRemainingText').textContent = t.downloadRemainingText;
            document.getElementById('footerText').textContent = t.footerText;

            // Update modal text
            document.querySelector('#downloadModal h2').textContent = t.downloadModalTitle;
            document.querySelector('#downloadModal p').textContent = t.downloadModalDesc;
            document.querySelector('#downloadModal button:first-of-type span').textContent = t.pdfBtnText;
            document.querySelector('#downloadModal button:last-of-type span').textContent = t.imageBtnText;
        }

        function switchTab(tab) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            if (tab === 'shopping') {
                document.getElementById('shoppingPage').classList.add('active');
                document.getElementById('shoppingTab').classList.add('active');
                setTimeout(() => document.getElementById('itemInput').focus(), 100);
            }
        }

        function addItem() {
            const input = document.getElementById('itemInput');
            const text = input.value.trim();

            if (!text) {
                alert(translations[currentLanguage].enterItem);
                return;
            }

            items.push({
                id: Date.now(),
                text: text,
                purchased: false,
                matched: false
            });

            input.value = '';
            input.focus();
            renderItems();
            saveData();
        }

        function toggleItem(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.purchased = !item.purchased;
                renderItems();
                saveData();
            }
        }

        function deleteItem(id) {
            items = items.filter(item => item.id !== id);
            renderItems();
            saveData();
        }

        function renderItems() {
            const listDiv = document.getElementById('shoppingList');
            const statsDiv = document.getElementById('statsContainer');
            const actionsDiv = document.getElementById('actionButtons');

            if (items.length === 0) {
                listDiv.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>${translations[currentLanguage].noItems}</p></div>`;
                statsDiv.style.display = 'none';
                actionsDiv.style.display = 'none';
                return;
            }

            statsDiv.style.display = 'grid';
            actionsDiv.style.display = 'flex';

            listDiv.innerHTML = items.map(item => `
                <li class="shopping-item ${item.purchased ? 'bought' : ''} ${item.matched ? 'matched' : ''}">
                    <div class="checkbox-circle" onclick="toggleItem(${item.id})" style="background: ${item.purchased ? '#27ae60' : '#e9ecef'}; color: ${item.purchased ? 'white' : '#667eea'}; border-color: ${item.purchased ? '#27ae60' : '#e9ecef'};">
                        ${item.purchased ? '‚úì' : ''}
                    </div>
                    <div style="flex: 1;">
                        <div class="item-text">${item.text}</div>
                        ${item.matched ? '<div class="item-badge" style="margin-top: 4px;">‚úì Found in Invoice</div>' : ''}
                    </div>
                    <button class="delete-btn" onclick="deleteItem(${item.id})"><i class="fa-solid fa-trash-can"></i></button>
                </li>
            `).join('');

            updateSummary();
        }

        function updateSummary() {
            const total = items.length;
            const purchased = items.filter(i => i.purchased).length;
            const remaining = total - purchased;

            document.getElementById('totalItems').textContent = total;
            document.getElementById('purchasedCount').textContent = purchased;
            document.getElementById('remainingCount').textContent = remaining;
        }

        function clearPurchased() {
            const purchasedCount = items.filter(i => i.purchased).length;
            
            if (purchasedCount === 0) {
                alert(translations[currentLanguage].noItems);
                return;
            }

            if (confirm(translations[currentLanguage].confirmClear)) {
                items = items.filter(i => !i.purchased);
                renderItems();
                saveData();
            }
        }

        function clearAll() {
            if (items.length === 0) {
                alert(translations[currentLanguage].noItems);
                return;
            }

            if (confirm(translations[currentLanguage].confirmClearAll)) {
                items = [];
                renderItems();
                saveData();
            }
        }

        function downloadRemaining() {
            const remainingItems = items.filter(item => !item.purchased);
            if (remainingItems.length === 0) {
                alert(translations[currentLanguage].noRemainingItems);
                return;
            }
            document.getElementById('downloadModal').classList.add('show');
        }

        function closeDownloadModal() {
            document.getElementById('downloadModal').classList.remove('show');
        }

        async function downloadAsPDF() {
            const remainingItems = items.filter(item => !item.purchased);
            if (remainingItems.length === 0) {
                alert('No remaining items to download!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Add title
            doc.setFontSize(20);
            doc.text('Remaining Shopping Items', 20, 30);

            // Add date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 45);

            // Add items
            doc.setFontSize(14);
            let yPosition = 65;
            remainingItems.forEach((item, index) => {
                if (yPosition > 270) { // New page if needed
                    doc.addPage();
                    yPosition = 30;
                }
                doc.text(`${index + 1}. ${item.text}`, 20, yPosition);
                yPosition += 10;
            });

            // Add summary
            yPosition += 10;
            doc.setFontSize(12);
            doc.text(`Total remaining items: ${remainingItems.length}`, 20, yPosition);

            // Download the PDF
            doc.save('remaining-shopping-items.pdf');
            closeDownloadModal();
        }

        async function downloadAsImage() {
            const remainingItems = items.filter(item => !item.purchased);
            if (remainingItems.length === 0) {
                alert('No remaining items to download!');
                return;
            }

            // Create a temporary div to capture
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.top = '-9999px';
            tempDiv.style.width = '400px';
            tempDiv.style.background = 'white';
            tempDiv.style.padding = '20px';
            tempDiv.style.fontFamily = 'Arial, sans-serif';
            tempDiv.style.borderRadius = '10px';
            tempDiv.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';

            tempDiv.innerHTML = `
                <h2 style="color: #667eea; margin-bottom: 10px; text-align: center;">Remaining Shopping Items</h2>
                <p style="color: #666; font-size: 12px; text-align: center; margin-bottom: 20px;">Generated on: ${new Date().toLocaleDateString()}</p>
                <ul style="list-style: none; padding: 0;">
                    ${remainingItems.map((item, index) => `
                        <li style="padding: 8px 0; border-bottom: 1px solid #eee; display: flex; align-items: center;">
                            <span style="background: #f39c12; color: white; border-radius: 50%; width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; margin-right: 10px;">${index + 1}</span>
                            <span style="color: #333;">${item.text}</span>
                        </li>
                    `).join('')}
                </ul>
                <p style="text-align: center; margin-top: 20px; color: #666; font-size: 12px;">Total remaining: ${remainingItems.length} items</p>
            `;

            document.body.appendChild(tempDiv);

            try {
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: 'white',
                    scale: 2
                });

                // Create download link
                const link = document.createElement('a');
                link.download = 'remaining-shopping-items.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (error) {
                console.error('Error generating image:', error);
                alert('Failed to generate image. Please try again.');
            } finally {
                document.body.removeChild(tempDiv);
                closeDownloadModal();
            }
        }

        // Initialize
        loadData();
        updatePageText();
        renderItems();
        document.getElementById('itemInput').focus();

        document.getElementById('itemInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addItem();
        });

        window.addEventListener('beforeunload', saveData);
    </script>
</body>
</html>
